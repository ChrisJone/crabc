(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7ad17259"],{"0cf3":function(e,a,t){e.exports=t.p+"img/ob.18fa38e1.png"},"1eed":function(e,a,t){},"47d9":function(e,a,t){e.exports=t.p+"img/db2.81d6cc2a.png"},6152:function(e,a,t){"use strict";t.r(a);t("cd17");var s=t("ed3b"),o=(t("a9e3"),{props:{tableType:{},tabcolumns:{type:Array,default:function(){return[]}},tabData:{type:Array,default:function(){return[]}},tabScrollX:{type:Number,default:1e3},operationBtn:{type:Array,default:function(){return[]}},isRowSelection:{type:Boolean,default:!1},defaultHeight:{type:Boolean,default:!1},pageNo:{type:Number,default:1},pageSize:{type:Number,default:10},total:{type:Number,default:0},showHead:{type:Boolean,default:!0}},data:function(){return{inputVal:"",currentPage:1,showRowSelection:null}},computed:{rowSelection:function(){return{onChange:function(e,a){}}},pagination:function(){var e=this;return{showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showQuickJumper:!0,size:"small",pageSize:this.pageSize,total:this.total,current:this.pageNo,showTotal:function(e){return"共 ".concat(e," 条")},onChange:function(a,t){e.$emit("changePage",{current:a,pageSize:t})},onShowSizeChange:function(a,t){e.$emit("changePage",{current:a,pageSize:t})}}}},created:function(){this.isRowSelection?this.showRowSelection=this.rowSelection:this.showRowSelection=null},methods:{detail:function(e){this.$api.serviceDetail.goDetail(e.apiId,e.apiCode)},btnClick:function(e,a,t){var o=this;if(this.clickItem=t,"删除"===e.text)s.a.confirm({title:this.$t("删除"),content:this.$t("当前操作会删除该条数据，是否继续？"),onOk:function(){var t=e.clickFunName;o.$emit("clickFunName",t),o.$emit("tabItem",a)},onCancel:function(){}});else{var r=e.clickFunName;this.$emit("clickFunName",r),this.$emit("tabItem",a)}"关联数据源"===e.text&&(this.$emit("visibleUser",!0),this.$emit("openTypeData","management",a)),"关联用户"===e.text&&(this.$emit("visibleUser",!0),this.$emit("openTypeData","Consumer",a)),"解绑"===e.text&&s.a.confirm({title:this.$t("解绑"),content:this.$t("当前操作会解绑该条数据，是否继续？"),onOk:function(){o.$api.serApproval.outerListDel({dataSourceId:a.datasourceId}).then((function(e){0===e.code&&(o.$message.success("解绑成功"),o.$parent.getDatasource())}))},onCancel:function(){}})},onDataSource:function(e,a){var t=this;"instance"===e||"UP"===e||"DOWN"===e?(this.$emit("clickFunName",e),this.$emit("tabItem",a)):s.a.confirm({title:this.$t("解绑"),content:this.$t("当前操作会解绑该条数据，是否继续？"),onOk:function(){t.$api.serApproval.outerListDel({dataSourceId:a.datasourceId}).then((function(e){0===e.code&&(t.$message.success("解绑成功"),t.$parent.getDatasource())}))},onCancel:function(){}})}}}),r=(t("8a29"),t("2877")),i=Object(r.a)(o,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"consumer-components-box",class:{"consumer-components-defaul-height":e.defaultHeight}},[e.showHead?t("div",{staticClass:"consumer-components-head"},[e._t("default")],2):e._e(),t("div",{staticClass:"consumer-components-table"},[t("a-table",{attrs:{"row-key":function(e,a){return"consumer"+a},columns:e.tabcolumns,"data-source":e.tabData,"row-selection":e.showRowSelection,pagination:"管理范围"!=e.tableType&&e.pagination,scroll:{x:e.tabScrollX}},scopedSlots:e._u([{key:"dataSourceStatus",fn:function(a){return[t("div",{style:{color:"DOWN"===a?"#F01010":""}},[e._v(e._s("UP"===a?"正常":"DOWN"===a?"已下线":""))])]}},{key:"versionCode",fn:function(a,s){return[t("a-button",{attrs:{type:"link"},on:{click:function(a){return e.detail(s)}}},[e._v(e._s(a))])]}},{key:"operation",fn:function(a,s){return[e._l(e.operationBtn,(function(a,o){return t("span",{key:o},[t("a-button",{class:a.roleCtrl&&"1"==s.roleId?{}:{"red-color":"删除"==a.text},attrs:{disabled:"DOWN"===s.status&&"下线"===a.text||"UP"===s.status&&"上线"===a.text||a.roleCtrl&&"1"==s.roleId,type:a.buttontype},on:{click:function(t){return e.btnClick(a,s,o)}}},[e._v(e._s(a.text))])],1)})),e._t("morebtn",null,{data:s})]}}],null,!0)})],1)])}),[],!1,null,"de2e8386",null).exports,c=(t("b0c0"),t("b37a"),{data:function(){return{typeList:[{name:"SQL",list:[{name:"MySQL",value:"icon-shujukuleixingtubiao-kuozhan-1",datasourceType:"mysql"},{name:"Oracle",value:"icon-shujukuleixingtubiao-kuozhan-",datasourceType:"oracle"},{name:"SQLServer",value:"icon-SQLServer",datasourceType:"sqlserver"},{name:"PostgreSQL",value:"icon-postgre-sql",datasourceType:"postgresql"},{name:"DB2",value:"icon-TDSQL",datasourceType:"db2"},{name:"TiDB",value:"icon-TIDB",datasourceType:"tidb"},{name:"openGauss",value:"icon-openGauss",datasourceType:"opengauss"},{name:"OceanBase",value:"icon-TDSQL",datasourceType:"oceanbase"},{name:"DM",value:"icon-TDSQL",datasourceType:"dm"},{name:"TDSQL",value:"icon-TDSQL",datasourceType:"tdsql"}]},{name:"NoSQL",list:[{name:"es",value:"icon-ElasticSearch-orange",datasourceType:"elasticsearch"}]}]}},computed:{},created:function(){},methods:{typeClick:function(e){switch(e.name){case"mongoDB":this.$message.warning("开发中");break;default:this.$emit("SqlType",e)}}}}),n=(t("8b790"),Object(r.a)(c,(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("div",{staticClass:"components-box"},e._l(e.typeList,(function(a,o){return s("div",{key:o,staticClass:"data-source-type"},[s("div",{staticClass:"data-source-type-title"},[e._v(e._s(a.name))]),e._l(a.list,(function(a,o){return s("div",{key:o,staticClass:"data-source-type-content"},[s("div",{staticClass:"data-source-content-child",on:{click:function(t){return e.typeClick(a)}}},["DM"===a.name?s("img",{staticClass:"icon-img",attrs:{src:t("ea93")}}):"OceanBase"===a.name?s("img",{staticClass:"icon-img",attrs:{src:t("0cf3")}}):"DB2"===a.name?s("img",{staticClass:"icon-img",attrs:{src:t("47d9")}}):s("i",{staticClass:"iconfont",class:a.value}),e._v(" "+e._s(a.name)+" ")])])}))],2)})),0)}),[],!1,null,"964ae7aa",null).exports),u=t("9816"),l={inject:["reload"],props:{sqlTypeName:{type:Object,default:function(){}},rowItem:{type:Object,default:function(){}}},watch:{},data:function(){return{formLayout:"horizontal",form:this.$form.createForm(this,{name:"coordinated"}),datasourceType:"",disableDatasource:!1,isRequiredpasswd:!0,isChecked:!1,key:"",public:""}},computed:{},created:function(){var e=this;this.sqlTypeName.datasourceType;this.isRequiredpasswd=!1,setTimeout((function(){if(e.rowItem){e.datasourceType=e.rowItem.datasourceType,e.disableDatasource=!0;var a=e.rowItem.extra?JSON.parse(e.rowItem.extra):null;e.isChecked=!(!a||"Y"!=a.enableSecurity),setTimeout((function(){e.form.setFieldsValue({datasourceName:e.rowItem.datasourceName,remarks:e.rowItem.datasourceDesc,host:a?a.host:"",port:a?a.port:"",requestTimeout:a?a.requestTimeout:"",connectTimeout:a?a.connectTimeout:"",retryTime:a?a.retryTime:"",refreshInterval:a?a.refreshInterval:"",username:a?a.user:"",password:e.rowItem.passwd})}),500)}else e.datasourceType=e.sqlTypeName.datasourceType}),100)},methods:{handleSubmit:function(e){var a=this;this.form.validateFields((function(t,s){t||a.getRsaPublic(s,e)}))},newDatasource:function(e){var a=this,t=e.passwd;"***"==t||(t=t?this.encryptedData(this.public,t):"");var s=new FormData;s.append("datasourceName",e.datasourceName||""),s.append("datasourceType",this.sqlTypeName.datasourceType||""),s.append("remarks",e.datasourceDesc||""),s.append("jdbcUrl",e.host+":"+e.port),s.append("host",e.host||""),s.append("port",e.port||""),s.append("extra.requestTimeout",e.requestTimeout||""),s.append("extra.connectTimeout",e.connectTimeout||""),s.append("extra.retryTime",e.retryTime||""),s.append("extra.refreshInterval",e.refreshInterval||""),s.append("extra.enableSecurity",this.isChecked?"Y":"N"),this.isChecked&&(s.append("username",e.user||""),s.append("password",t||""),s.append("key",this.key||"")),this.$api.account.newDatasource(s).then((function(e){e.data&&a.$message.success(e.data),a.reload()}))},updateDatasource:function(e){var a=this,t=e.passwd;"***"==t||(t=t?this.encryptedData(this.public,t):"");var s=new FormData;s.append("datasourceId",this.rowItem.datasourceId),s.append("datasourceName",e.datasourceName),s.append("datasourceType",this.sqlTypeName.datasourceType),s.append("remarks",e.datasourceDesc||""),s.append("jdbcUrl",e.host+":"+e.port),s.append("host",e.host||""),s.append("port",e.port||""),s.append("extra.requestTimeout",e.requestTimeout||""),s.append("extra.connectTimeout",e.connectTimeout||""),s.append("extra.retryTime",e.retryTime||""),s.append("extra.refreshInterval",e.refreshInterval||""),s.append("extra.enableSecurity",this.isChecked?"Y":"N"),this.isChecked&&(s.append("username",e.user||""),s.append("password",t||""),s.append("key",this.key)),this.$api.account.updateDatasource(s).then((function(e){e.data&&a.$message.success(e.data),a.reload()}))},testDatasource:function(){var e=this;this.form.validateFields((function(a,t){a||e.getRsaPublic(t,"测试连通性")}))},testDatasourceApi:function(e){var a=this,t=e.passwd;"***"==t||(t=t?this.encryptedData(this.public,t):"");var s=new FormData;s.append("datasourceId",this.rowItem?this.rowItem.datasourceId:""),s.append("datasourceName",e.datasourceName),s.append("datasourceType",this.sqlTypeName.datasourceType||this.rowItem.datasourceType),s.append("remarks",e.datasourceDesc||""),s.append("host",e.host||""),s.append("port",e.port||""),s.append("extra.requestTimeout",e.requestTimeout||""),s.append("extra.connectTimeout",e.connectTimeout||""),s.append("extra.retryTime",e.retryTime||""),s.append("extra.refreshInterval",e.refreshInterval||""),s.append("extra.enableSecurity",this.isChecked?"Y":"N"),this.isChecked&&(s.append("username",e.user||""),s.append("password",t||""),s.append("key",this.key)),this.$api.account.testDatasource(s).then((function(e){e.data&&a.$message.success(e.data)}))},onceClick:function(){this.form.setFieldsValue({passwd:""})},getRsaPublic:function(e,a){var t=this;this.$api.account.getRsaPublic().then((function(s){t.key=s.data.key,t.public=s.data.public,a&&"新增数据源"==a&&t.newDatasource(e),a&&"修改数据源"==a&&t.updateDatasource(e),a&&"测试连通性"==a&&t.public&&t.testDatasourceApi(e)}))},encryptedData:function(e,a){var t=new u.a;return t.setPublicKey(e),t.encrypt(a)},kerverosChange:function(e){this.isChecked=e}}},d=(t("a9a4"),Object(r.a)(l,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"components-box"},[t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}},on:{submit:e.handleSubmit}},[t("a-form-item",{attrs:{label:"数据源名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["datasourceName",{rules:[{required:!0,message:"请输入数据源名称!"}]}],expression:"['datasourceName', { rules: [{ required: true, message: '请输入数据源名称!' }] }]"}],attrs:{oninput:"value=value.replace(/\\s/g,'')",placeholder:"请输入数据源名称"}})],1),t("a-form-item",{attrs:{label:"主机IP地址",extra:"多个IP使用,逗号分隔"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["host",{rules:[{required:!0,message:"请输入主机IP地址!"}]}],expression:"['host', { rules: [{ required: true, message: '请输入主机IP地址!' }] }]"}],attrs:{oninput:"value=value.replace(/\\s/g,'')",placeholder:"样例：127.0.0.1"}})],1),t("a-form-item",{attrs:{label:"服务端口"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["port",{rules:[{required:!0,message:"请输入ES服务端口!"}]}],expression:"['port', { rules: [{ required: true, message: '请输入ES服务端口!' }] }]"}],attrs:{oninput:"value=value.replace(/\\s/g,'')",placeholder:"样例：9200"}})],1),t("a-form-item",{attrs:{label:"数据源描述"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["datasourceDesc",{rules:[{required:!1,message:"请输入数据源描述!"}]}],expression:"['datasourceDesc', { rules: [{ required: false, message: '请输入数据源描述!' }] }]"}],attrs:{placeholder:"请输入数据源描述"}})],1),t("a-form-item",{attrs:{label:"是否开启密码认证："}},[t("a-row",[t("a-col",{attrs:{span:6}},[t("a-switch",{on:{change:e.kerverosChange},model:{value:e.isChecked,callback:function(a){e.isChecked=a},expression:"isChecked"}})],1)],1)],1),e.isChecked?t("span",[t("a-form-item",{attrs:{label:"认证用户名："}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["user",{rules:[{required:!0,message:"请输入认证用户名：!"}]}],expression:"['user', { rules: [{ required: true, message: '请输入认证用户名：!' }] }]"}],attrs:{placeholder:"样例：elastic"}})],1),t("a-form-item",{attrs:{label:"认证密码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["passwd",{rules:[{required:!0,message:"请输入认证密码!"}]}],expression:"['passwd', { rules: [{ required: true, message: '请输入认证密码!' }] }]"}],attrs:{oninput:"value=value.replace(/\\s/g,'')",placeholder:"请输入密码",type:"password",autocomplete:"new-password"},on:{"~click":function(a){return e.onceClick(a)}}})],1)],1):e._e()],1)],1)}),[],!1,null,"405776bf",null).exports),p={inject:["reload"],props:{sqlTypeName:{type:Object,default:function(){}},rowItem:{type:Object,default:function(){}}},components:{EsForm:d},data:function(){return{formLayout:"horizontal",form:this.$form.createForm(this,{name:"coordinated"}),datasourceType:"",disableDatasource:!1,jbcdplaceholder:"请输入JDBC地址",jdbcLable:"JDBC URL",isRequiredPasswd:!0,key:"",public:"",showPublicForm:!0}},computed:{},created:function(){var e=this;switch(this.sqlTypeName.datasourceType){case"oceanbase":case"tdsql":case"mysql":this.jbcdplaceholder="jdbc:mysql://localhost:3306?useSSL=false&autoReconnect=true";break;case"oracle":this.jbcdplaceholder="jdbc:oracle:thin:@//localhost:1521/instanceName";break;case"sqlserver":this.jbcdplaceholder="jdbc:sqlserver://localhost:1433;DatabaseName=xxx;encrypt=false";break;case"greenplum":case"postgresql":this.jbcdplaceholder="jdbc:postgresql://localhost:5432/database";break;case"db2":this.jbcdplaceholder="jdbc:db2://localhost:50000";break;case"opengauss":this.jbcdplaceholder="jdbc:postgresql://localhost:15400/database";break;case"dm":this.jbcdplaceholder="jdbc:dm://localhost:5236?logLevel=all";break;case"tidb":this.jbcdplaceholder="jdbc:mysql://localhost:4000";break;case"oceanbase":case"tdsql":this.jbcdplaceholder="jdbc:mysql://localhost:3306";break;case"elasticsearch":case"mongodb":this.isRequiredPasswd=!1,this.showPublicForm=!1;break;default:this.jbcdplaceholder="请输入JDBC连接地址"}setTimeout((function(){switch(e.rowItem?e.rowItem.datasourceType:e.sqlTypeName.datasourceType){case"hive-hadoop2":e.isRequiredPasswd=!1}e.rowItem?(e.datasourceType=e.rowItem.datasourceType,e.disableDatasource=!0,e.form.setFieldsValue({datasourceCode:e.rowItem.datasourceCode,datasourceName:e.rowItem.datasourceName,jdbcUrl:e.rowItem.jdbcUrl,username:e.rowItem.username,password:e.rowItem.password,remarks:e.rowItem.remarks})):(e.form.setFieldsValue({jdbcUrl:e.jbcdplaceholder}),e.datasourceType=e.sqlTypeName.datasourceType)}),300)},methods:{handleSubmit:function(e){var a=this;this.form.validateFields((function(t,s){t||a.getRsaPublic(s,e)}))},modalConfim:function(){},newDatasource:function(e){var a=this,t=e.password;t=t?this.encryptedData(this.public,t):"";var s=new FormData;s.append("datasourceCode",e.datasourceCode),s.append("datasourceName",e.datasourceName),s.append("datasourceType",this.sqlTypeName.datasourceType),s.append("jdbcUrl",e.jdbcUrl),s.append("username",e.username||""),s.append("password",t||""),s.append("remarks",e.remarks||""),s.append("key",this.key),this.$api.account.newDatasource(s).then((function(e){e.data&&a.$message.success(e.data),a.reload()}))},updateDatasource:function(e){var a=this,t=e.password;t="******"==t?null:t?this.encryptedData(this.public,t):"";var s=new FormData;s.append("datasourceId",this.rowItem.datasourceId),s.append("datasourceCode",e.datasourceCode),s.append("datasourceName",e.datasourceName),s.append("datasourceType",this.sqlTypeName.datasourceType),s.append("jdbcUrl",e.jdbcUrl),s.append("username",e.username||""),s.append("password",t||""),s.append("remarks",e.remarks||""),s.append("key",this.key),this.$api.account.updateDatasource(s).then((function(e){e.data&&a.$message.success(e.data),a.reload()}))},testDatasource:function(){var e=this;this.$api.account.getRsaPublic().then((function(a){e.key=a.data.key,e.public=a.data.public,e.form.validateFields((function(a,t){if(!a){var s=t.password;s="******"==s?null:s?e.encryptedData(e.public,s):"";var o=new FormData;o.append("datasourceId",e.rowItem?e.rowItem.datasourceId:""),o.append("datasourceCode",t.datasourceCode),o.append("datasourceName",t.datasourceName),o.append("datasourceType",e.sqlTypeName.datasourceType||e.rowItem.datasourceType),o.append("jdbcUrl",t.jdbcUrl),o.append("username",t.username||""),o.append("password",s||""),o.append("remarks",t.remarks||""),o.append("key",e.key),e.$api.account.testDatasource(o).then((function(a){a.data&&e.$message.success(a.data)}))}}))}))},onceClick:function(){this.form.setFieldsValue({password:""})},getRsaPublic:function(e,a){var t=this;this.$api.account.getRsaPublic().then((function(s){t.key=s.data.key,t.public=s.data.public,"新增数据源"==a&&t.newDatasource(e),"修改数据源"==a&&t.updateDatasource(e)}))},encryptedData:function(e,a){var t=new u.a;return t.setPublicKey(e),t.encrypt(a)}}},m={name:"DataSource",inject:["reload"],components:{JurisdictionTable:i,DataSourceType:n,DataSourceEdit:Object(r.a)(p,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"components-box"},[e.showPublicForm?t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}},on:{submit:e.handleSubmit}},[t("a-form-item",{attrs:{label:"数据源名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["datasourceName",{rules:[{required:!0,message:"请输入数据源名称!"}]}],expression:"['datasourceName', { rules: [{ required: true, message: '请输入数据源名称!' }] }]"}],attrs:{placeholder:"请输入数据源名称"}})],1),t("a-form-item",{attrs:{label:e.jdbcLable}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["jdbcUrl",{rules:[{required:!0,message:"请输入JDBC URL!"}]}],expression:"['jdbcUrl', { rules: [{ required: true, message: '请输入JDBC URL!' }] }]"}],attrs:{oninput:"value=value.replace(/\\s/g,'')",placeholder:e.jbcdplaceholder}})],1),t("a-form-item",{attrs:{label:"用户名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:e.isRequiredPasswd,message:"请输入用户名!"}]}],expression:"['username', { rules: [{ required: isRequiredPasswd, message: '请输入用户名!' }] }]"}],attrs:{oninput:"value=value.replace(/\\s/g,'')",placeholder:"请输入用户名",autocomplete:"off"}})],1),t("a-form-item",{attrs:{label:"密码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:e.isRequiredPasswd,message:"请输入密码!"}]}],expression:"['password', { rules: [{ required: isRequiredPasswd, message: '请输入密码!' }] }]"}],attrs:{oninput:"value=value.replace(/\\s/g,'')",placeholder:"请输入密码",type:"password",autocomplete:"new-password"},on:{"~click":function(a){return e.onceClick(a)}}})],1),t("a-form-item",{attrs:{label:"数据源描述"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["remarks",{rules:[{required:!1,message:"请输入数据源描述!"}]}],expression:"['remarks', { rules: [{ required: false, message: '请输入数据源描述!' }] }]"}],attrs:{placeholder:"请输入数据源描述"}})],1)],1):e._e(),(this.rowItem?"elasticsearch"==this.rowItem.datasourceType:"elasticsearch"==this.sqlTypeName.datasourceType)?t("EsForm",{ref:"EsForm",attrs:{sqlTypeName:e.sqlTypeName,rowItem:e.rowItem}}):e._e()],1)}),[],!1,null,"a27b60b6",null).exports},data:function(){return{visibleDataSource:!1,visibleDataSourceEdit:!1,visibleMetadata:!1,isRowSelection:null,isShow:!0,datasourceName:"",datasourceType:void 0,rowItem:{},pageNum:1,pageSize:10,total:0,clickFun:"",SqlTypeName:{},tabcolumns:[{title:"ID",dataIndex:"datasourceId",key:"datasourceId",width:80},{title:"名称",dataIndex:"datasourceName",key:"datasourceName",width:120,ellipsis:!0,scopedSlots:{customRender:"datasourceName"}},{title:"类型",dataIndex:"datasourceType",key:"datasourceType",width:100},{title:"连接信息",dataIndex:"jdbcUrl",key:"jdbcUrl",ellipsis:!0,width:300,scopedSlots:{customRender:"jdbcUrl"}},{title:"描述",dataIndex:"remarks",key:"remarks",width:120,ellipsis:!0},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",width:150},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:160}],tabData:[],operationBtn:[{buttontype:"link",text:"编辑",clickFunName:"editFun"},{buttontype:"link",text:"删除",clickFunName:"deleteFun"}],selectOptionsOfRMDB:[{name:"mysql",value:"mysql"},{name:"oracle",value:"oracle"},{name:"sqlserver",value:"sqlserver"},{name:"postgresql",value:"postgresql"},{name:"openGauss",value:"opengauss"},{name:"TiDB",value:"tidb"},{name:"TDSQL",value:"tdsql"}],selectOptionsOfBigDataDB:[{name:"hive",value:"hive-hadoop2"},{name:"hbase",value:"hbase-connector"}],selectOptionsOfNoSqlDB:[{name:"es",value:"elasticsearch"},{name:"mongodb",value:"mongodb"}],showPublicForm:!0}},created:function(){switch(this.getDatasource(),this.rowItem.datasourceType){case"elasticsearch":case"mongodb":this.showPublicForm=!1}},methods:{getDatasource:function(){var e=this,a={datasourceName:this.datasourceName,datasourceType:this.datasourceType,pageNum:this.pageNum,pageSize:this.pageSize};this.$api.account.dataSourceList(a).then((function(a){e.tabData=a.data.list,e.total=a.data.total}))},refreshCache:function(){var e=this,a={datasourceId:this.rowItem.datasourceId,datasourceCode:this.rowItem.datasourceCode};this.$api.datasource.refreshCache(a).then((function(a){e.$message.success(a.data),e.getDatasource()}))},hbaseShowModal:function(e){this.rowItem=e.data,this.visibleMetadata=!0},searchFun:function(){this.pageNum=1,this.getDatasource()},resetFun:function(){this.datasourceName="",this.datasourceType=void 0,this.pageNum=1,this.pageSize=10,this.getDatasource()},onlineFun:function(e){var a=this,t="online"===e?"确认上线？":"确认下线？",o="online"===e?"上线后，此数据源将正常响应API数据查询请求！":"下线后，关联此数据源的API将无法查询成功！";s.a.confirm({title:this.$t(t),content:this.$t(o),onOk:function(){a.confirmOnline()},onCancel:function(){}})},confirmOnline:function(){var e=this;this.$api.serApproval.datasource({datasourceId:this.rowItem.datasourceId,status:"UP"===this.rowItem.status?"DOWN":"UP"}).then((function(a){e.$message.success("UP"===e.rowItem.status?"下线成功":"上线成功"),e.getDatasource()}))},tabItem:function(e){switch(this.rowItem=e,this.clickFun){case"online":this.onlineFun("online");break;case"offline":this.onlineFun("offline");break;case"deleteFun":this.deleteFun();break;case"editFun":this.modalTitle="修改数据源",this.visibleDataSourceEdit=!0,this.SqlTypeName=this.rowItem;break;case"refreshCache":this.refreshCache()}},deleteFun:function(){var e=this;this.$api.account.deleteDatasource(this.rowItem.datasourceId).then((function(a){e.$message.success(a.data),e.reload()}))},clickFunName:function(e){this.clickFun=e},newlyBuild:function(){this.modalTitle="新增数据源",this.visibleDataSource=!0,this.isShow=!0},SqlType:function(e){e&&(this.isShow=!1,this.SqlTypeName=e)},hideModalConsumer:function(){},modalBack:function(){this.isShow=!0},modalCancel:function(){this.isShow=!1,this.visibleDataSource=!1,this.visibleDataSourceEdit=!1},modalTest:function(){switch(this.SqlTypeName.datasourceType){case"elasticsearch":"新增数据源"==this.modalTitle?this.$refs.DataSourceEdit.$refs.EsForm.testDatasource():this.$refs.DataSourceEditModal.$refs.EsForm.testDatasource();break;case"mongodb":"新增数据源"==this.modalTitle?this.$refs.DataSourceEdit.$refs.MongodbForm.testDatasource():this.$refs.DataSourceEditModal.$refs.MongodbForm.testDatasource();break;default:"新增数据源"==this.modalTitle?this.$refs.DataSourceEdit.testDatasource():this.$refs.DataSourceEditModal.testDatasource()}},modalConfim:function(){switch(this.SqlTypeName.datasourceType){case"elasticsearch":"新增数据源"==this.modalTitle?this.$refs.DataSourceEdit.$refs.EsForm.handleSubmit(this.modalTitle):this.$refs.DataSourceEditModal.$refs.EsForm.handleSubmit(this.modalTitle);break;case"mongodb":"新增数据源"==this.modalTitle?this.$refs.DataSourceEdit.$refs.MongodbForm.handleSubmit(this.modalTitle):this.$refs.DataSourceEditModal.$refs.MongodbForm.handleSubmit(this.modalTitle);break;default:"新增数据源"==this.modalTitle?this.$refs.DataSourceEdit.handleSubmit(this.modalTitle):this.$refs.DataSourceEditModal.handleSubmit(this.modalTitle)}},changePage:function(e){this.pageNum=e.pageSize===this.pageSize?e.current:1,this.pageSize=e.pageSize,this.getDatasource()}}},h=(t("9d29"),Object(r.a)(m,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"jurisdiction-box"},[t("JurisdictionTable",{attrs:{tabcolumns:e.tabcolumns,"tab-data":e.tabData,"operation-btn":e.operationBtn,"is-row-selection":e.isRowSelection,"page-no":e.pageNum,"page-size":e.pageSize,total:e.total},on:{tabItem:e.tabItem,clickFunName:e.clickFunName,changePage:e.changePage},scopedSlots:e._u([{key:"morebtn",fn:function(a){return["hbase-connector"==a.data.datasourceType?t("a-button",{attrs:{type:"link"},on:{click:function(t){return e.hbaseShowModal(a)}}},[e._v("元数据维护")]):e._e()]}}])},[e._t("default",[t("div",{staticClass:"consumer-components-head-top"},[e._v(" 数据源名称： "),t("a-input",{staticClass:"consumer-components-input",attrs:{allowClear:"",placeholder:"请输入数据源名称"},on:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.searchFun(a)}},model:{value:e.datasourceName,callback:function(a){e.datasourceName=a},expression:"datasourceName"}}),t("a-button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:e.searchFun}},[e._v("查询")]),t("a-button",{attrs:{icon:"plus"},on:{click:e.newlyBuild}},[e._v("新建")])],1)])],2),e.visibleDataSource?t("a-modal",{attrs:{title:e.modalTitle,width:680,maskClosable:!1,footer:null},model:{value:e.visibleDataSource,callback:function(a){e.visibleDataSource=a},expression:"visibleDataSource"}},[e.isShow?t("DataSourceType",{on:{SqlType:e.SqlType}}):e._e(),e.isShow?e._e():t("DataSourceEdit",{ref:"DataSourceEdit",attrs:{"sql-type-name":e.SqlTypeName}}),t("div",{staticClass:"modal-footer"},[e.isShow?e._e():t("a-button",{staticClass:"mr20",on:{click:e.modalBack}},[e._v("上一步")]),e.isShow?e._e():t("a-button",{staticClass:"mr20",on:{click:e.modalTest}},[e._v("测试连接")]),e.isShow?e._e():t("a-button",{staticClass:"mr20",attrs:{type:"primary"},on:{click:e.modalConfim}},[e._v("确定")])],1)],1):e._e(),e.visibleDataSourceEdit?t("a-modal",{attrs:{title:e.modalTitle,"ok-text":"确认","cancel-text":"取消",width:680,footer:null},on:{ok:e.hideModalConsumer},model:{value:e.visibleDataSourceEdit,callback:function(a){e.visibleDataSourceEdit=a},expression:"visibleDataSourceEdit"}},[e.showPublicForm?t("DataSourceEdit",{ref:"DataSourceEditModal",attrs:{"sql-type-name":e.SqlTypeName,"row-item":e.rowItem}}):e._e(),t("div",{staticClass:"modal-footer"},[t("a-button",{staticClass:"mr20",on:{click:e.modalCancel}},[e._v("取消")]),t("a-button",{staticClass:"mr20",on:{click:e.modalTest}},[e._v("测试连接")]),t("a-button",{staticClass:"mr20",attrs:{type:"primary"},on:{click:e.modalConfim}},[e._v("确定")])],1)],1):e._e(),e.visibleMetadata?t("a-modal",{staticClass:"metadata-modal",attrs:{title:"元数据维护",width:800,footer:null},model:{value:e.visibleMetadata,callback:function(a){e.visibleMetadata=a},expression:"visibleMetadata"}}):e._e()],1)}),[],!1,null,"478b5d39",null));a.default=h.exports},7767:function(e,a,t){},"8a29":function(e,a,t){"use strict";t("7767")},"8b790":function(e,a,t){"use strict";t("95a9")},"95a9":function(e,a,t){},"9d29":function(e,a,t){"use strict";t("1eed")},a9a4:function(e,a,t){"use strict";t("de18")},b37a:function(e,a,t){},de18:function(e,a,t){},ea93:function(e,a,t){e.exports=t.p+"img/dm.cce965ce.png"}}]);